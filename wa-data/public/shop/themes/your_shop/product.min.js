function Product(e,t){this.form=$(e),this.add2cart=this.form.find(".all-price"),this.button=this.form.find("input[type=submit]");for(var a in t)this[a]=t[a];var i=this;this.button.click(function(){$(this).attr("disabled")||i.form.submit()});var r=$.cookie("yourshop_product_sku");r&&$.cookie("yourshop_product_sku",null,{path:$.yourshop.shopUrl}),this.form.find(".services input[type=checkbox]").click(function(){var e=$('select[name="service_variant['+$(this).val()+']"]');e.length&&($(this).is(":checked")?e.removeAttr("disabled"):e.attr("disabled","disabled")),i.updatePrice()}),this.form.find(".services .service-variants").on("change",function(){i.updatePrice()}),this.form.find(".inline-select a").click(function(){var e=$(this),t=e.closest(".inline-select");return t.find("a.selected").removeClass("selected").find(".fa-check").remove(),e.addClass("selected"),t.hasClass("color")&&e.prepend("<i class='fa fa-check'></i>"),t.find(".sku-feature").val(e.data("value")).change(),!1}),this.form.find(".inline-select a.selected").click(),this.form.find(".skus input[type=radio]").click(function(){var e=$(this),t=e.data("image-id");if(t&&!e.hasClass("without-click")){$(".product-image-"+t).addClass("without-click").click();var a=$(".image-thumb-dialog[data-image-id='"+t+"']");a.length&&($(".image-thumb-dialog").hide(),a.show())}e.hasClass("without-click")&&e.prop("checked",!0),e.removeClass("without-click"),e.data("disabled")?i.button.attr("disabled","disabled"):i.button.removeAttr("disabled");var r=e.val();i.updateSku(e.closest("li").find(".sku-sku").data("sku"),e.closest(".product-page").find(".s-sku")),i.updateSkuServices(r),i.updatePrice()}),this.form.find(".skus input[type=radio]:checked").click();var s=1;this.form.find(".sku-feature").change(function(){var e="";if(i.form.find(".sku-feature").each(function(){e+=$(this).data("feature-id")+":"+$(this).val()+";"}),"undefined"!==i.major_feature&&$(".sku-feature[data-feature-id='"+i.major_feature+"']").length){var t=$(".sku-feature[data-feature-id='"+i.major_feature+"']"),a=t.data("feature-id")+":"+t.val()+";",r=$(".sku-feature:not([data-feature-id='"+i.major_feature+"'])"),d=r.data("feature-id"),c=0,o="";if($(this).data("feature-id")==t.data("feature-id")||s)if(r.is(":input")){if(r.siblings(".temp-block").remove(),r.siblings("a").each(function(){var t=$(this),r=i.major_first?a+d+":"+t.data("value")+";":d+":"+t.data("value")+";"+a;i.features[r]?i.features[r]&&!i.features[r].available?t.show().addClass("disabled"):(o=t,t.show().removeClass("disabled")):(t.hide(),e==r&&(c=1))}),c)return r.siblings("a:visible").length?o.click():r.after("<a class='disabled temp-block' href='javascript:void(0)' title=''>"+$.yourshop.translate("Empty")+"</a>"),!1;s=0}else{if(r.find("option").each(function(){var t=$(this),r=i.major_first?a+d+":"+t.val()+";":d+":"+t.val()+";"+a;i.features[r]?i.features[r]&&!i.features[r].available?t.prop("disabled",!0):(o=t,t.show().prop("disabled",!1)):(t.hide(),e==r&&(c=1))}),c)return r.val(o.val()).change(),!1;s=0}}var l=i.features[e],n=$(this).closest(".product-page").find(".s-sku");if(l){if(l.image_id){$(".product-image-"+l.image_id).click();var u=$(".image-thumb-dialog[data-image-id='"+l.image_id+"']");u.length&&($(".image-thumb-dialog").hide(),u.show())}i.updateSkuServices(l.id),l.available?i.button.removeAttr("disabled"):i.button.attr("disabled","disabled"),i.add2cart.find(".price").data("price",l.price),i.updatePrice(l.price,l.compare_price),"undefined"!=typeof i.sku_names[l.id]?i.updateSku(i.sku_names[l.id],n):n.hide()}else i.form.find("div.stocks > div").hide(),i.form.find(".sku-no-stock").show(),i.button.attr("disabled","disabled"),i.add2cart.find(".compare-price").hide(),i.add2cart.find(".price").empty(),n.hide()}),this.form.find(".sku-feature:first").change(),this.form.find(".skus input:radio:checked").length||this.form.find(".skus input:radio:enabled:first").attr("checked","checked"),this.form.submit(function(){var e=function(e){$(".cart-total, .fly-cart .total").html(e.total),$("#cart").find(".indicator").text(e.count),$(".fly-discount .discount").html(e.discount)},t=$(this);t.attr("data-id","");var a=t.find("input[type='submit']");return a.hasClass("active")||(a.addClass("active"),$.post(t.attr("action")+"?html="+("html"==$.yourshop.ruble?"1":"0"),t.serialize(),function(r){if(a.removeClass("active"),"ok"==r.status){var s=$("#cart"),d=$(".cart-total, .fly-cart .total");if($(".cart-page").length&&$.get(location.href,function(e){$(".cart-page").html($(e).html()),d.html(r.data.total)},"html"),r.data.error)alert(r.data.error);else{s.find(".indicator").text(r.data.count).show();var c=a.val(),o=parseInt(t.find(".add2cart input[name='quantity']").val())||1,l=$(".fly-cart"),n=l.find(".fly-item[data-id='"+r.data.item_id+"']"),u=t.find("input[name='sku_id']:checked").val(),f=0,h=t.closest(".dialog");if(h.length&&!h.hasClass("quick-view-dial")?f=1:(a.val($.yourshop.translate("Added")),setTimeout(function(){a.val(c)},2500)),n.length){var p=n.find(".qty"),m=n.find(".fly-price"),v=parseFloat(m.text().replace(",",".").replace(/[^\d\.]/g,""))+parseFloat(t.find(".all-price .price").attr("data-price"))*o;o+=parseInt(p.val()),p.val(o),m.html("~"+i.currencyFormat(v,"html"==$.yourshop.ruble?0:1))}else{var g=t.find("li[data-id='"+u+"'] .s-radio-name"),k=f?t.find("h4").data("url"):"",y='<div class="fly-item" data-id="'+r.data.item_id+'"><div class="fly-img">'+(f?'<a href="'+k+'" title="'+t.find("h4").data("name")+'">'+(t.find(".image-thumb-dialog:visible").length?t.find(".image-thumb-dialog:visible").clone().removeClass().prop("outerHTML"):t.find(".image > img").clone().removeClass().prop("outerHTML"))+"</a>":t.closest(".product-page").find(".image-thumb a.selected").length?t.closest(".product-page").find(".image-thumb a.selected img").clone().removeClass().prop("outerHTML"):t.closest(".product-page").find(".image").data("small"))+'</div><div class="fly-info"><div class="fly-name">'+(f?'<a href="'+t.find("h4").data("url")+'">'+escapeHtml(t.find("h4").data("name"))+"</a>":escapeHtml(t.closest(".product-page").find("h1[itemprop='name']").text()))+(g.length&&g.text()?" ("+escapeHtml(g.text())+")":"")+'</div><div class="fly-quantity"><a href="javascript:void(0)" title="'+$.yourshop.translate("decrease")+'" class="f-minus"><i class="ys ys-larr"></i></a><input type="text" value="'+o+'" class="qty" /><a href="javascript:void(0)" title="'+$.yourshop.translate("increase")+'" class="f-plus"><i class="ys ys-rarr"></i></a></div><div class="fly-price price colored">~'+i.currencyFormat(parseFloat(t.find(".all-price .price").attr("data-price"))*o,"html"==$.yourshop.ruble?0:1)+'</div></div><div class="fly-icons"><a href="javascript:void(0)" class="delete" title="'+$.yourshop.translate("Delete")+'" data-id="'+r.data.item_id+'">x</a></div></div>';if(!s.hasClass("has-items")){var b=s.find("a");$(".fly-content").find("p").remove(),b.attr("href",b.data("url")).parent().addClass("has-items")}$(".fly-content").append(y)}s.addClass("has-items"),e(r.data),(f||h.length&&h.hasClass("quick-view-dial"))&&h.find(".dialog-close").click(),bouncePopup(s,"+ "+$.yourshop.translate("Added to cart"))}}else"fail"==r.status&&alert(r.errors)},"json")),!1})}Product.prototype.currencyFormat=function(e,t){var a,i,r,s,d,c=this.currency.frac_digits,o=this.currency.decimal_point,l=this.currency.thousands_sep;isNaN(c=Math.abs(c))&&(c=2),void 0==o&&(o=","),void 0==l&&(l="."),a=parseInt(e=(+e||0).toFixed(c))+"",(i=a.length)>3?i%=3:i=0,d=i?a.substr(0,i)+l:"",r=a.substr(i).replace(/(\d{3})(?=\d)/g,"$1"+l),s=c&&e-a?o+Math.abs(e-a).toFixed(c).replace(/-/,0).slice(2):"";var e=d+r+s,n=t?this.currency.sign:this.currency.sign_html;return this.currency.sign_position?e+this.currency.sign_delim+n:n+this.currency.sign_delim+e},Product.prototype.serviceVariantHtml=function(e,t,a){return $('<option data-price="'+a+'" value="'+e+'"></option>').html(t+" (+"+this.currencyFormat(a,1)+")")},Product.prototype.updateSkuServices=function(e){this.form.find("div.stocks > div").hide(),this.form.find(".sku-"+e+"-stock").show();for(var t in this.services[e]){var a=this.services[e][t];if(a===!1)this.form.find(".service-"+t).hide().find("input,select").attr("disabled","disabled").removeAttr("checked");else if(this.form.find(".service-"+t).show().find("input").removeAttr("disabled"),"string"==typeof a)this.form.find(".service-"+t+" .service-price").html(this.currencyFormat(a,"html"==$.yourshop.ruble?0:1)),this.form.find(".service-"+t+" input").data("price",a);else{var i=this.form.find(".service-"+t+" .service-variants"),r=i.val();for(var s in a){var d=i.find("option[value="+s+"]");a[s]===!1?(d.hide(),d.attr("value")==r&&(r=!1)):(r||(r=s),d.replaceWith(this.serviceVariantHtml(s,a[s][0],a[s][1])))}this.form.find(".service-"+t+" .service-variants").val(r)}}},Product.prototype.updatePrice=function(e,t){if(void 0===e){var a=this.form.find(".skus input:radio:checked");if(a.length)var e=parseFloat(a.data("price")),t=parseFloat(a.data("compare-price"));else var e=parseFloat(this.add2cart.find(".price").data("price"))}t?(this.add2cart.find(".compare-price").length||this.add2cart.append('<div class="compare-price"></div>'),this.add2cart.find(".compare-price").html(this.currencyFormat(t,"html"==$.yourshop.ruble?0:1)).show()):this.add2cart.find(".compare-price").hide();var i=this;this.form.find(".services input:checked").each(function(){var t=$(this).val();e+=i.form.find(".service-"+t+"  .service-variants").length?parseFloat(i.form.find(".service-"+t+"  .service-variants :selected").data("price")):parseFloat($(this).data("price"))}),this.add2cart.find(".price").html(this.currencyFormat(e,"html"==$.yourshop.ruble?0:1)).attr("data-price",e)},Product.prototype.updateSku=function(e,t){e?t.show().find("span").text(e):t.hide()};